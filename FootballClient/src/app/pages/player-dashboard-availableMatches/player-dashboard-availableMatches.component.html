<app-header (tabChange)="setActiveTab($event)"></app-header>
<app-friend-requests></app-friend-requests>

<div class="dashboard-container">
  <div class="main-content">
    <div class="content-section" style="margin-top: 30px">
      <h2>Public Matches</h2>
      <p class="subtitle">Public matches from friends you can join</p>
      @if (availableMatches.length === 0) {
      <div class="empty-state">No public matches to join.</div>
      } @if (availableMatches.length > 0) {
      <div class="matches-table">
        <div class="table-header">
          <div class="col-team">Teams</div>
          <div class="col-date">Date</div>
          <div class="col-type">Type</div>
          <div class="col-price">Price per Player</div>
          <div class="col-action">Action</div>
        </div>

        @for (match of availableMatches; track match) {
        <div class="table-row">
          <div class="col-team">
            {{ match.teamAName }} vs {{ match.teamBName }}
          </div>
          <div class="col-date">
            {{ match.matchDate | date : "dd/MM/yyyy" }}
          </div>
          <div class="col-type">
            <span
              class="match-type"
              [class]="match.isPublic ? 'public' : 'private'"
            >
              {{ match.isPublic ? "Public" : "Private" }}
            </span>
          </div>
          <div class="col-price">
            <div class="price-breakdown">
              @if (match.cost && match.cost > 0) {
              <div class="price-option">
                10 players: <strong>{{ getPriceInfo(match).for10 }} lei</strong>
              </div>
              <div class="price-option">
                11 players: <strong>{{ getPriceInfo(match).for11 }} lei</strong>
              </div>
              <div class="price-option">
                12 players:
                <strong>{{ getPriceInfo(match).for12 }} lei </strong>
              </div>
              } @else {
              <span class="free-match">FREE</span>
              }
            </div>
          </div>
          <div class="col-action">
            <button class="action-btn" (click)="openJoinMatchModal(match)">
              View & Join
            </button>
          </div>
        </div>
        }
      </div>
      }
    </div>
  </div>

  <!-- Regular Modal (View Teams) -->
  @if (modalOpen && modalType === 'view') {
  <div class="modal-backdrop" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="close-modal-btn" (click)="closeModal()">×</button>
      <h3>{{ selectedTeamAName }} vs {{ selectedTeamBName }}</h3>

      <div class="teams-container">
        <div class="team-list">
          <h4>{{ selectedTeamAName }}</h4>
          <ul>
            @for (player of selectedTeamAPlayers; track player) {
            <li>{{ player }}</li>
            }
          </ul>
        </div>
        <div class="vs-divider">VS</div>
        <div class="team-list">
          <h4>{{ selectedTeamBName }}</h4>
          <ul>
            @for (player of selectedTeamBPlayers; track player) {
            <li>{{ player }}</li>
            }
          </ul>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Join Match Modal -->
  @if (modalOpen && modalType === 'join') {
  <div class="modal-backdrop" (click)="closeModal()">
    <div class="modal-content join-modal" (click)="$event.stopPropagation()">
      <button class="close-modal-btn" (click)="closeModal()">×</button>
      <h3>Join Match: {{ selectedTeamAName }} vs {{ selectedTeamBName }}</h3>
      <p class="modal-subtitle">Choose which team to join</p>

      <div class="join-teams-container">
        <div
          class="join-team-card"
          (click)="joinTeam(selectedMatch?.teamAId || 0)"
        >
          <div class="team-header">
            <h4>{{ selectedTeamAName }}</h4>
            <span class="team-count"
              >{{ selectedTeamAPlayers.length }} players</span
            >
          </div>
          <div class="team-players">
            @for (player of selectedTeamAPlayers; track player) {
            <div class="player-item">
              {{ player }}
            </div>
            } @if (selectedTeamAPlayers.length === 0) {
            <div class="no-players">No players yet</div>
            }
          </div>
          <button class="join-team-btn">Join {{ selectedTeamAName }}</button>
        </div>

        <div class="vs-divider-join">VS</div>

        <div
          class="join-team-card"
          (click)="joinTeam(selectedMatch?.teamBId || 0)"
        >
          <div class="team-header">
            <h4>{{ selectedTeamBName }}</h4>
            <span class="team-count"
              >{{ selectedTeamBPlayers.length }} players</span
            >
          </div>
          <div class="team-players">
            @for (player of selectedTeamBPlayers; track player) {
            <div class="player-item">
              {{ player }}
            </div>
            } @if (selectedTeamBPlayers.length === 0) {
            <div class="no-players">No players yet</div>
            }
          </div>
          <button class="join-team-btn">Join {{ selectedTeamBName }}</button>
        </div>
      </div>
    </div>
  </div>
  }
</div>
