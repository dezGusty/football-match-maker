<app-header></app-header>

<div class="carousel-container">
    <!-- Slide Indicators -->
    <div class="slide-indicators">
        <div class="indicator" [class.active]="currentSlide === 1" (click)="goToSlide(1)"></div>
        <div class="indicator" [class.active]="currentSlide === 2" (click)="goToSlide(2)"></div>
    </div>

    <!-- Selected Date Display (shown on second slide) -->
    <div class="selected-date-display" *ngIf="currentSlide === 2 && selectedDate">
        📅 Selected: {{ getFormattedDate() }}
    </div>

    <div class="carousel-wrapper" [ngClass]="'slide-' + currentSlide">
        <!-- Slide 1: Calendar Selection -->
        <div class="carousel-slide calendar-slide">
            <div class="calendar-container">
                <div class="calendar-icon">📅</div>
                <div class="calendar-header">
                    <h2>Select Match Date</h2>
                    <p>Choose when you want to play your match</p>
                </div>

                <div class="date-input-container">
                    <input type="date" [(ngModel)]="matchDate" [min]="minDate" class="date-input"
                        (change)="validateDate()">
                </div>

                <button class="next-step-btn" [disabled]="!selectedDate" (click)="goToNextSlide()">
                    Continue to Player Selection →
                </button>
            </div>
        </div>

        <!-- Slide 2: Player Selection -->
        <div class="carousel-slide players-slide">
            <div class="players-container">
                <div class="column">
                    <div class="column-header">
                        <h3>Available Players</h3>
                        <span class="player-count">{{ filteredAvailablePlayers.length }} Players</span>
                    </div>
                    <div class="search-container">
                        <input type="text" [(ngModel)]="searchTerm" placeholder="Search player..."
                            class="search-input" />
                    </div>
                    <ul class="players-list">
                        <li *ngFor="let player of filteredAvailablePlayers" class="player-item">
                            <div class="player-info">
                                <span [class.player-locked]="player.locked">{{ player.firstName }} {{ player.lastName
                                    }}</span>
                                <span class="player-rating">Rating: {{ player.rating }}</span>
                            </div>
                            <button class="select-button" (click)="selectPlayer(player)"
                                [disabled]="selectedPlayers.length >= maxAvailable">
                                Select
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="column">
                    <div class="column-header">
                        <h3>Selected Players</h3>
                        <span class="player-count"
                            [ngClass]="selectedPlayers.length < 10 ? 'count-red' : 'count-green'">
                            {{ maxAvailable - selectedPlayers.length }} Players left
                        </span>
                    </div>
                    <ul class="players-list">
                        <li *ngFor="let player of selectedPlayers" class="player-item">
                            <div class="player-info">
                                <span>{{ player.firstName }} {{ player.lastName }}</span>
                                <span class="player-rating">Rating: {{ player.rating }}</span>
                            </div>
                            <button class="select-button" (click)="unselectPlayer(player)" style="background: #dc3545;">
                                Remove
                            </button>
                        </li>
                    </ul>
                    <button *ngIf="selectedPlayers.length >= 10" class="floating-btn" (click)="generateTeams()">
                        Finalize Selection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="carousel-navigation">
        <button *ngIf="currentSlide === 2" class="nav-btn secondary" (click)="goToPreviousSlide()">
            ← Back to Date
        </button>
    </div>
</div>

<!-- Teams Modal (existing modal code) -->
@if (showTeamsModal) {
<div class="modal">
    <div class="modal-content">
        <button class="close-btn" (click)="closeTeamsModal()">&times;</button>
        <div class="modal-header">
            <h2>Generated teams</h2>
            <button class="shuffle-btn" (click)="shuffleTeams()">
                🔄 Shuffle Teams
            </button>
        </div>

        <div class="teams-container">
            <div class="team">
                <input type="text" [(ngModel)]="team1Name" class="team-name-input" />
                <h3>({{ team1.players.length }} players - {{ team1.averageRating | number:'1.1-1' }})</h3>
                <ul>
                    <li *ngFor="let player of team1.players" class="player-team-item">
                        <div class="player-controls">
                            <span class="lock-icon" [class.unlocked]="!player.locked" (click)="toggleLock(player)"
                                style="cursor:pointer;" title="{{ player.locked ? 'Unlock player' : 'Lock player' }}">
                                {{ player.locked ? '🔒' : '🔓' }}
                            </span>
                            <button class="move-btn" (click)="movePlayerToOtherTeam(player, 'team1')"
                                title="Move to Team 2" [disabled]="player.locked">
                                ➡️
                            </button>
                        </div>
                        <div class="player-info-team">
                            <span [class.player-locked]="player.locked">{{ player.firstName }} {{ player.lastName
                                }}</span>
                            <span class="rating-badge" [class]="'rating-' + getRatingCategory(player.rating)">
                                {{ player.rating }}
                            </span>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="team">
                <input type="text" [(ngModel)]="team2Name" class="team-name-input" />
                <h3>({{ team2.players.length }} players - {{ team2.averageRating | number:'1.1-1' }})</h3>
                <ul>
                    <li *ngFor="let player of team2.players" class="player-team-item">
                        <div class="player-controls">
                            <button class="move-btn" (click)="movePlayerToOtherTeam(player, 'team2')"
                                title="Move to Team 1" [disabled]="player.locked">
                                ⬅️
                            </button>
                            <span class="lock-icon" [class.unlocked]="!player.locked" (click)="toggleLock(player)"
                                style="cursor:pointer;" title="{{ player.locked ? 'Unlock player' : 'Lock player' }}">
                                {{ player.locked ? '🔒' : '🔓' }}
                            </span>
                        </div>
                        <div class="player-info-team">
                            <span [class.player-locked]="player.locked">{{ player.firstName }} {{ player.lastName
                                }}</span>
                            <span class="rating-badge" [class]="'rating-' + getRatingCategory(player.rating)">
                                {{ player.rating }}
                            </span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="modal-actions">
            <button class="begin-match-btn" (click)="beginMatch()">Begin Match</button>
            <button class="begin-match-btn" (click)="scheduleMatch()"
                style="background: #6a866e; margin-left: 10px;">Schedule Match</button>
        </div>
    </div>
</div>
}