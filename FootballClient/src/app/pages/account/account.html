<app-header></app-header>

<div class="account-fullpage">
  <div class="account-avatar-col">
    <div
      class="avatar-big"
      (click)="triggerFileInput()"
      [style.cursor]="'pointer'"
    >
      @if (user && user.profileImageUrl) {
      <img [src]="user.profileImageUrl" alt="Profile" class="profile-image" />
      } @else {
      <span class="material-icons avatar-icon-big">person</span>
      }
      <div class="upload-overlay">
        <span class="material-icons">camera_alt</span>
      </div>
    </div>

    <input
      #fileInput
      type="file"
      accept="image/*"
      (change)="onFileSelected($event)"
      style="display: none"
    />

    @if (isUploadingImage) {
    <div class="upload-status">Uploading...</div>
    } @if (uploadError) {
    <div class="upload-error">{{ uploadError }}</div>
    } @if (user && user.profileImageUrl && !user.profileImageUrl.includes('default-avatar')) {
    <button class="delete-image-btn" (click)="deleteProfileImage()">
      Remove Photo
    </button>
    }

    <button class="logout-btn" (click)="logout()">Logout</button>
  </div>
  <div class="account-details-col">
    @if (user) {
    <div class="account-username">{{ user.username }}</div>
    <div class="account-role-badge">{{ getRoleString(user.role) }}</div>

    <div class="settings-toggles">
      <button
        class="toggle-btn"
        [class.active]="showPasswordForm"
        (click)="togglePasswordForm()"
      >
        Change Password
      </button>
      <button
        class="toggle-btn"
        [class.active]="showUsernameForm"
        (click)="toggleUsernameForm()"
      >
        Change Username
      </button>
    </div>

    @if (showPasswordForm) {
    <form class="account-password-form">
      <label for="current-password">Current Password</label>
      <input
        id="current-password"
        type="password"
        placeholder="Enter current password"
        [(ngModel)]="currentPassword"
        name="currentPassword"
      />
      <label for="new-password">New Password</label>
      <input
        id="new-password"
        type="password"
        placeholder="Enter new password"
        [(ngModel)]="newPassword"
        name="newPassword"
      />
      <label for="confirm-password">Confirm Password</label>
      <input
        id="confirm-password"
        type="password"
        placeholder="Confirm new password"
        [(ngModel)]="confirmPassword"
        name="confirmPassword"
      />
      <button type="button" (click)="changePassword()">Save Changes</button>
    </form>
    } @if (showUsernameForm) {
    <form class="account-password-form">
      <label for="new-username">New Username</label>
      <input
        id="new-username"
        type="text"
        placeholder="Enter new username"
        [(ngModel)]="newUsername"
        name="newUsername"
      />
      <label for="username-password">Password (for confirmation)</label>
      <input
        id="username-password"
        type="password"
        placeholder="Enter your password"
        [(ngModel)]="usernamePassword"
        name="usernamePassword"
      />
      <button type="button" (click)="changeUsername()">Save Username</button>
    </form>
    } } @else {
    <div class="loading-message">Loading account details...</div>
    }
  </div>
</div>
