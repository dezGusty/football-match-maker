<!-- Player Header -->
<app-player-header (tabChange)="setActiveTab($event)"></app-player-header>
<app-friend-requests></app-friend-requests>

<!-- Main Container -->
<div class="dashboard-container">
  <!-- Main Content Area -->
  <div class="main-content">
    <!-- My Matches Section - Always visible -->
    <div class="content-section">
      <h2>My Upcoming Matches</h2>
      <p class="subtitle">Matches you are enrolled in</p>
      <div *ngIf="upcomingMatches.length === 0" class="empty-state">
        You are not enrolled in any upcoming matches.
      </div>

      <div class="matches-table" *ngIf="upcomingMatches.length > 0">
        <div class="table-header">
          <div class="col-team">Teams</div>
          <div class="col-date">Date</div>
          <div class="col-your-team">Your Team</div>
          <div class="col-action">Action</div>
        </div>

        <div class="table-row" *ngFor="let match of upcomingMatches">
          <div class="col-team">
            {{ match.teamAName }} vs {{ match.teamBName }}
          </div>
          <div class="col-date">
            {{ match.matchDate | date : "dd/MM/yyyy" }}
          </div>
          <div class="col-your-team">{{ getPlayerTeamName(match) }}</div>
          <div class="col-action">
            <button class="action-btn" (click)="openPlayersModal(match)">
              View Teams
            </button>
            <button
              class="leave-btn"
              (click)="leaveMatch(match)"
              [title]="
                canLeaveMatch(match)
                  ? 'Leave Match'
                  : 'Added by organizer - cannot leave'
              "
              [disabled]="!canLeaveMatch(match)"
            >
              Leave Match
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Regular Modal (View Teams) -->
    <div
      *ngIf="modalOpen && modalType === 'view'"
      class="modal-backdrop"
      (click)="closeModal()"
    >
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-modal-btn" (click)="closeModal()">×</button>
        <h3>{{ selectedTeamAName }} vs {{ selectedTeamBName }}</h3>

        <div class="teams-container">
          <div class="team-list">
            <h4>{{ selectedTeamAName }}</h4>
            <ul>
              <li *ngFor="let player of selectedTeamAPlayers">{{ player }}</li>
            </ul>
          </div>
          <div class="vs-divider">VS</div>
          <div class="team-list">
            <h4>{{ selectedTeamBName }}</h4>
            <ul>
              <li *ngFor="let player of selectedTeamBPlayers">{{ player }}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Join Match Modal -->
    <div
      *ngIf="modalOpen && modalType === 'join'"
      class="modal-backdrop"
      (click)="closeModal()"
    >
      <div class="modal-content join-modal" (click)="$event.stopPropagation()">
        <button class="close-modal-btn" (click)="closeModal()">×</button>
        <h3>Join Match: {{ selectedTeamAName }} vs {{ selectedTeamBName }}</h3>
        <p class="modal-subtitle">Choose which team to join</p>

        <div class="join-teams-container">
          <div
            class="join-team-card"
            (click)="joinTeam(selectedMatch?.teamAId || 0)"
          >
            <div class="team-header">
              <h4>{{ selectedTeamAName }}</h4>
              <span class="team-count"
                >{{ selectedTeamAPlayers.length }} players</span
              >
            </div>
            <div class="team-players">
              <div
                *ngFor="let player of selectedTeamAPlayers"
                class="player-item"
              >
                {{ player }}
              </div>
              <div *ngIf="selectedTeamAPlayers.length === 0" class="no-players">
                No players yet
              </div>
            </div>
            <button class="join-team-btn">Join {{ selectedTeamAName }}</button>
          </div>

          <div class="vs-divider-join">VS</div>

          <div
            class="join-team-card"
            (click)="joinTeam(selectedMatch?.teamBId || 0)"
          >
            <div class="team-header">
              <h4>{{ selectedTeamBName }}</h4>
              <span class="team-count"
                >{{ selectedTeamBPlayers.length }} players</span
              >
            </div>
            <div class="team-players">
              <div
                *ngFor="let player of selectedTeamBPlayers"
                class="player-item"
              >
                {{ player }}
              </div>
              <div *ngIf="selectedTeamBPlayers.length === 0" class="no-players">
                No players yet
              </div>
            </div>
            <button class="join-team-btn">Join {{ selectedTeamBName }}</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
