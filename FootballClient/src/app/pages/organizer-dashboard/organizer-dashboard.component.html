<!-- Create Match Modal -->
@if (showCreateMatchModal) {
<div
  class="modal-backdrop"
  style="z-index: 100"
  (click)="showCreateMatchModal = false"
>
  <div
    class="modal-content glass create-match-modal"
    (click)="$event.stopPropagation()"
    style="z-index: 101"
  >
    <button
      class="close-modal-btn"
      (click)="showCreateMatchModal = false"
      title="Close"
    >
      &times;
    </button>
    <h3>Create New Match</h3>
    <!-- ...existing create match modal content... -->
  </div>
</div>
}

<!-- Save as Template Popup (overlays Create Match Modal) -->
@if (showSaveAsTemplatePopup) {
<div
  class="modal-backdrop"
  style="
    z-index: 200;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
  "
  (click)="showSaveAsTemplatePopup = false"
>
  <div
    class="modal-content glass"
    (click)="$event.stopPropagation()"
    style="z-index: 201; position: fixed"
  >
    <button
      class="close-modal-btn"
      (click)="showSaveAsTemplatePopup = false"
      title="Close"
    >
      &times;
    </button>
    <h3>Save Match as Template?</h3>
    <p>Would you like to save this match setup as a template for future use?</p>
    <div class="modal-actions">
      <button class="primary-cta" (click)="handleSaveAsTemplateChoice(true)">
        Yes, Save as Template
      </button>
      <button
        class="btn btn-secondary"
        (click)="handleSaveAsTemplateChoice(false)"
      >
        No, Just Create Match
      </button>
    </div>
  </div>
</div>
}
<app-header></app-header>
<app-friend-requests></app-friend-requests>

<div class="page">
  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button
      class="tab-btn"
      [class.active]="activeTab === 'matches'"
      (click)="activeTab = 'matches'"
    >
      Matches
    </button>

    <button
      class="tab-btn"
      [class.active]="activeTab === 'myMatches'"
      (click)="activeTab = 'myMatches'"
    >
      My Matches
    </button>
  </div>

  <!-- Floating Actions - Organizer Only -->
  <div class="fab-stack">
    @if (activeTab === 'matches') {
    <button
      class="fab primary"
      (click)="showCreateMatchModal = true"
      aria-label="Create new match"
    >
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
        <path
          d="M12 5v14M5 12h14"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        />
      </svg>
    </button>
    }

    <button
      class="fab primary"
      (click)="showAddModal = true"
      aria-label="Add new player"
    >
      <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
        <!-- Player icon -->
        <path
          d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"
          stroke="currentColor"
          stroke-width="2"
          fill="none"
        />
        <circle
          cx="8.5"
          cy="7"
          r="4"
          stroke="currentColor"
          stroke-width="2"
          fill="none"
        />
        <!-- Plus sign for adding -->
        <line
          x1="20"
          y1="8"
          x2="20"
          y2="14"
          stroke="currentColor"
          stroke-width="2"
        />
        <line
          x1="17"
          y1="11"
          x2="23"
          y2="11"
          stroke="currentColor"
          stroke-width="2"
        />
      </svg>
    </button>
  </div>

  <!-- Organizer Matches Table -->
  @if (activeTab === 'matches') {
  <div
    class="table-wrapper"
    role="region"
    aria-label="Matches table"
    tabindex="0"
  >
    <table class="matches-table modern">
      <thead>
        <tr>
          <th>#</th>
          <th>Date & Time</th>
          <th>Teams</th>
          <th>Location</th>
          <th>Cost Total</th>
          <th>Status</th>
          <th>Visibility</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (match of matches; track match; let i = $index) {
        <tr class="row-anim" [style.animationDelay]="i * 40 + 'ms'">
          <td>{{ i + 1 }}</td>
          <td>{{ match.matchDate | date : "short" }}</td>
          <td class="teams-cell">
            <div class="team-names">
              <span class="team-a">{{ match.teamAName || "TeamA" }}</span>
              <span class="vs">vs</span>
              <span class="team-b">{{ match.teamBName || "TeamB" }}</span>
            </div>
          </td>
          <td>{{ match.location || "TBD" }}</td>
          <td>{{ match.cost ? match.cost + " Lei" : "Free" }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(match.status)">
              {{ getStatusText(match.status) }}
            </span>
          </td>
          <td>
            @if (match.status == 0) {
            <button
              class="action-btn"
              [class.make-public-btn]="!match.isPublic"
              [class.make-private-btn]="match.isPublic"
              [title]="match.isPublic ? 'Make Private' : 'Make Public'"
              (click)="
                match.isPublic
                  ? makeMatchPrivate(match.id)
                  : makeMatchPublic(match.id)
              "
            >
              {{ match.isPublic ? "Make Private" : "Make Public" }}
            </button>
            } @else {
            <span class="status-text">
              {{ match.isPublic ? "Public" : "Private" }}
            </span>
            }
          </td>
          <td class="actions">
            @if (match.status == 3) {
            <span class="status-text"> No actions available </span>
            } @else {
            <button
              class="action-btn add-players-btn"
              [title]="getAddPlayersButtonText(match)"
              (click)="openAddPlayersModal(match)"
            >
              {{ getAddPlayersButtonText(match) }}
            </button>
            } @if (match.status === 0) {
            <button
              class="action-btn edit-btn"
              title="Edit Match"
              (click)="openEditMatchModal(match)"
            >
              Edit
            </button>
            } @if (canShowCloseButton(match)) {
            <button
              class="action-btn close-btn"
              title="Close Match"
              (click)="closeMatch(match)"
            >
              Close
            </button>
            } @if (match.status === 0) {
            <button
              class="action-btn cancel-btn"
              title="Cancel Match"
              (click)="cancelMatch(match)"
            >
              Cancel
            </button>
            } @if (canShowFinalizeButton(match)) {
            <button
              class="action-btn finalize-btn"
              title="Finalize Match"
              (click)="openFinalizeMatchModal(match)"
            >
              Finalize
            </button>
            }
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }

  <!--My matches section-->
  @if (activeTab === 'myMatches') {
  <div
    class="table-wrapper"
    role="region"
    aria-label="Matches table"
    tabindex="0"
  >
    <table class="matches-table modern">
      <thead>
        <tr>
          <th>#</th>
          <th>Date & Time</th>
          <th>Teams</th>
          <th>Location</th>
          <th>Price per Player</th>
        </tr>
      </thead>
      <tbody>
        @for (match of myMatches; track match; let i = $index) {
        <tr
          class="row-anim my-match-row"
          [style.animationDelay]="i * 40 + 'ms'"
        >
          <td>{{ i + 1 }}</td>
          <td>{{ match.matchDate | date : "short" }}</td>
          <td class="teams-cell">
            <div class="team-names">
              <span
                class="team-a"
                [ngClass]="{ 'my-team': match.myTeam === 'A' }"
                >{{ match.teamAName || "TeamA" }}</span
              >
              <span class="vs">vs</span>
              <span
                class="team-b"
                [ngClass]="{ 'my-team': match.myTeam === 'B' }"
                >{{ match.teamBName || "TeamB" }}</span
              >
            </div>
          </td>
          <td>{{ match.location || "TBD" }}</td>
          <td>
            @if (match.cost && match.cost > 0) {
            <div class="price-breakdown">
              <!-- Show exact price for closed matches -->
              @if (match.status === 1 && getPriceInfo(match).exactPrice) {
              <div class="exact-price">
                <div class="price-option exact">
                  <strong>{{ getPriceInfo(match).exactPrice }} lei</strong>
                </div>
              </div>
              } @else {
              <!-- Show estimated prices for open matches -->
              <div class="price-option">
                10 players: <strong>{{ getPriceInfo(match).for10 }} lei</strong>
              </div>
              <div class="price-option">
                11 players: <strong>{{ getPriceInfo(match).for11 }} lei</strong>
              </div>
              <div class="price-option">
                12 players: <strong>{{ getPriceInfo(match).for12 }} lei</strong>
              </div>
              }
            </div>
            } @else {
            <span class="free-match">FREE</span>
            }
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  } @if (showFinalizeMatchModal) {
  <div class="modal-backdrop" (click)="closeFinalizeMatchModal()">
    <div
      class="modal-content glass add-players-modal"
      (click)="$event.stopPropagation()"
    >
      <button
        class="close-modal-btn"
        (click)="closeFinalizeMatchModal()"
        title="Close"
      >
        &times;
      </button>

      <h3>Finalize Match</h3>
      <div class="match-info-fin">
        <div>
          <p>
            <strong
              >{{ selectedMatch?.teamAName || "TeamA" }} vs
              {{ selectedMatch?.teamBName || "TeamB" }}</strong
            >
          </p>
          <p>
            {{ selectedMatch?.matchDate | date : "short" }} -
            {{ selectedMatch?.location }}
          </p>
        </div>
        <!-- Rating Multiplier Slider -->
        @if (selectedRatingSystem.startsWith('Custom')) {
        <div class="rating-multiplier">
          <label>Rating Multiplier: {{ ratingMultiplier }}x</label>
          <input
            type="range"
            [(ngModel)]="ratingMultiplier"
            (input)="updateRatingPreview()"
            min="0.5"
            max="2"
            step="0.1"
            class="slider"
          />
          <div class="slider-marks">
            <span>0.5x</span>
            <span>2x</span>
          </div>
        </div>
        }
        <div>
          <select
            [(ngModel)]="selectedRatingSystem"
            (ngModelChange)="updateRatingPreview()"
          >
            <option value="Linear">Linear</option>
            <option value="Performance">Performance</option>
            <option value="Custom Linear">Custom Linear</option>
            <option value="Custom Performance">Custom Performance</option>
            <!-- <option value="Vote">Vote</option> -->
          </select>
        </div>
      </div>
      <div class="teams-panel-fin">
        <div class="teams-container-fin">
          <!-- Team 1 -->
          <div class="team-table">
            <div class="team-header">
              <h4>Team 1</h4>
              <div class="team-stats">
                <input
                  class="score-input"
                  type="number"
                  placeholder="Team 1 Score"
                  [(ngModel)]="teamAScore"
                  (ngModelChange)="updateRatingPreview()"
                  min="0"
                  step="1"
                />
              </div>
            </div>

            <div class="team-players-simple">
              @for (player of teamAPlayers; track player; let i = $index) {
              <div class="simple-player-row">
                <span class="player-name"
                  >{{ player.firstName }} {{ player.lastName }}
                </span>
                <div class="rating-info">
                  <span class="player-rating">
                    Rating: {{ (player.rating | number : "1.0-2") || "N/A" }}
                    <span [class]="getRatingChangeClass(player.id)">{{
                      getRatingPreviewForPlayer(player.id)
                    }}</span>
                  </span>
                  <!-- Manual rating input -->
                  <div class="manual-rating">
                    <div class="manual-rating">
                      <input
                        class="manual-rating-input"
                        type="number"
                        [(ngModel)]="manualRatings[player.id]"
                        (ngModelChange)="updateManualRating(player.id)"
                        min="-10"
                        max="10"
                        step="0.1"
                        placeholder="0.0"
                      />
                    </div>
                  </div>
                </div>
              </div>
              }

              <!-- Empty slots -->
              @for ( slot of getEmptySlots(teamAPlayers.length); track slot; let
              i = $index ) {
              <div class="empty-slot-simple">
                <span class="empty-text">Empty slot</span>
              </div>
              }
            </div>
          </div>

          <!-- Team 2 -->
          <div class="team-table">
            <div class="team-header">
              <h4>Team 2</h4>
              <div class="team-stats">
                <input
                  class="score-input"
                  type="number"
                  placeholder="Team 2 Score"
                  [(ngModel)]="teamBScore"
                  (ngModelChange)="updateRatingPreview()"
                  min="0"
                  step="1"
                />
              </div>
            </div>

            <div class="team-players-simple">
              @for (player of teamBPlayers; track player; let i = $index) {
              <div class="simple-player-row">
                <span class="player-name"
                  >{{ player.firstName }} {{ player.lastName }}
                </span>
                <div class="rating-info">
                  <span class="player-rating">
                    Rating: {{ (player.rating | number : "1.0-2") || "N/A" }}
                    <span [class]="getRatingChangeClass(player.id)">{{
                      getRatingPreviewForPlayer(player.id)
                    }}</span>
                  </span>
                  <!-- Manual rating input -->
                  <div class="manual-rating">
                    <div class="manual-rating">
                      <input
                        class="manual-rating-input"
                        type="number"
                        [(ngModel)]="manualRatings[player.id]"
                        (ngModelChange)="updateManualRating(player.id)"
                        min="-10"
                        max="10"
                        step="0.1"
                        placeholder="0.0"
                      />
                    </div>
                  </div>
                </div>
              </div>
              }

              <!-- Empty slots -->
              @for ( slot of getEmptySlots(teamBPlayers.length); track slot; let
              i = $index ) {
              <div class="empty-slot-simple">
                <span class="empty-text">Empty slot</span>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
      <!-- Messages -->
      @if (addPlayersErrorMessage) {
      <div class="error-message">
        {{ addPlayersErrorMessage }}
      </div>
      } @if (addPlayersSuccessMessage) {
      <div class="success-message">
        {{ addPlayersSuccessMessage }}
      </div>
      }

      <!-- Actions -->
      <div class="modal-actions">
        <button class="btn action-btn" (click)="finalizeMatch()">
          Finalize Match
        </button>
        <button class="btn action-btn" (click)="closeFinalizeMatchModal()">
          Close
        </button>
      </div>
    </div>
  </div>
  }
  <!-- Add Player Modal -->
  @if (showAddModal) {
  <div class="modal-backdrop" (click)="showAddModal = false">
    <div class="modal-content glass" (click)="$event.stopPropagation()">
      <button
        class="close-modal-btn"
        (click)="showAddModal = false"
        title="Close"
      >
        &times;
      </button>
      <h3>Add New Player</h3>
      <p class="modal-subtitle">Add a new player to your team roster</p>

      <div class="grid two">
        <input
          type="text"
          placeholder="First Name *"
          [(ngModel)]="newPlayer.firstName"
        />
        <input
          type="text"
          placeholder="Last Name *"
          [(ngModel)]="newPlayer.lastName"
        />
      </div>

      <input type="email" placeholder="Email *" [(ngModel)]="newPlayer.email" />

      <input
        type="text"
        placeholder="Username *"
        [(ngModel)]="newPlayer.username"
      />

      <input
        type="number"
        placeholder="Rating (0-10000)"
        [(ngModel)]="newPlayer.rating"
        min="0"
        max="10000"
        step="1"
      />

      <app-stat-selector
        [speed]="newPlayer.speed"
        [stamina]="newPlayer.stamina"
        [errors]="newPlayer.errors"
        (speedChange)="newPlayer.speed = $event"
        (staminaChange)="newPlayer.stamina = $event"
        (errorsChange)="newPlayer.errors = $event"
      ></app-stat-selector>
      <!-- Messages -->
      @if (playerErrorMessage) {
      <div class="error-message">
        {{ playerErrorMessage }}
      </div>
      } @if (playerSuccessMessage) {
      <div class="success-message">
        {{ playerSuccessMessage }}
      </div>
      }

      <button
        class="primary-cta"
        (click)="addPlayer()"
        [disabled]="playerLoading"
      >
        @if (playerLoading) {
        <span>Adding Player...</span>
        } @else {
        <span>Add Player</span>
        }
      </button>
    </div>
  </div>
  }

  <!-- Create Match Modal -->
  @if (showCreateMatchModal) {
  <div class="modal-backdrop" (click)="showCreateMatchModal = false">
    <div
      class="modal-content glass create-match-modal"
      (click)="$event.stopPropagation()"
    >
      <button
        class="close-modal-btn"
        (click)="showCreateMatchModal = false"
        title="Close"
      >
        &times;
      </button>
      <h3>Create New Match</h3>

      <div class="match-template-layout">
        <div class="match-form-section">
          <!-- Date & Time -->
          <div class="form-group">
            <label>Match Date & Time *</label>
            <input
              type="datetime-local"
              [(ngModel)]="newMatch.matchDate"
              [min]="getMinDateTime()"
              required
            />
          </div>

          <!-- Location -->
          <div class="form-group">
            <label>Location *</label>
            <input
              type="text"
              placeholder="e.g., Central Stadium, Synthetic Field..."
              [(ngModel)]="newMatch.location"
              required
            />
          </div>

          <!-- Cost -->
          <div class="form-group">
            <label>Total Match Cost (Lei)</label>
            <input
              type="number"
              placeholder="e.g., 300"
              [(ngModel)]="newMatch.cost"
              min="0"
              step="0.01"
            />
          </div>

          <!-- Team Names -->
          <div class="team-names-section">
            <div class="grid two">
              <div class="form-group">
                <label>Team A Name</label>
                <input
                  type="text"
                  placeholder="Leave empty for 'TeamA'"
                  [(ngModel)]="newMatch.teamAName"
                  maxlength="50"
                />
              </div>
              <div class="form-group">
                <label>Team B Name</label>
                <input
                  type="text"
                  placeholder="Leave empty for 'TeamB'"
                  [(ngModel)]="newMatch.teamBName"
                  maxlength="50"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="templates-section">
          <h4>Match Templates</h4>
          <p class="template-info">
            Save frequently used locations, costs, and team names for quick
            access
          </p>

          <div class="template-list-container">
            <div class="template-list">
              <div class="template-list-header">
                <span class="template-name-header">Name</span>
                <span class="template-location-header">Location</span>
                <span class="template-cost-header">Cost</span>
                <span class="template-team-a-header">Team A</span>
                <span class="template-team-b-header">Team B</span>
                <span class="template-actions-header">Actions</span>
              </div>

              @if (templates.length === 0) {
              <div class="empty-templates">
                <p>No templates saved yet</p>
              </div>
              } @for (template of templates; track template) {
              <div class="template-item">
                <span class="template-name">{{ template.name }}</span>
                <span class="template-location">{{ template.location }}</span>
                <span class="template-cost">{{
                  template.cost ? template.cost + " Lei" : "Free"
                }}</span>
                <span
                  class="template-team-a"
                  [class.empty-value]="!template.teamAName"
                  >{{ template.teamAName || "-" }}</span
                >
                <span
                  class="template-team-b"
                  [class.empty-value]="!template.teamBName"
                  >{{ template.teamBName || "-" }}</span
                >
                <div class="template-actions">
                  <button
                    class="template-action-btn apply-btn"
                    (click)="applyTemplate(template)"
                    title="Apply template"
                  >
                    Apply
                  </button>
                  <button
                    class="template-action-btn edit-btn"
                    (click)="openEditTemplateModal(template)"
                    title="Edit template"
                  >
                    Edit
                  </button>
                  <button
                    class="template-action-btn delete-btn"
                    (click)="deleteTemplate(template.id!)"
                    title="Delete template"
                  >
                    Delete
                  </button>
                </div>
              </div>
              }
            </div>
          </div>

          <div class="create-template-section">
            <h5>Save Current Settings as Template</h5>
            <div class="create-template-form">
              <div class="form-group">
                <input
                  type="text"
                  placeholder="Enter template name..."
                  [(ngModel)]="newTemplate.name"
                  required
                />
              </div>
              <!-- <div class="template-teams-container">
                <div class="form-group">
                  <input
                    type="text"
                    placeholder="Team A name"
                    [(ngModel)]="newTemplate.teamAName"
                  />
                </div>
                <div class="form-group">
                  <input
                    type="text"
                    placeholder="Team B name"
                    [(ngModel)]="newTemplate.teamBName"
                  />
                </div>
              </div> -->
              <button
                class="save-template-btn"
                (click)="
                  newTemplate.location = newMatch.location;
                  newTemplate.cost = newMatch.cost;
                  newTemplate.teamAName = newMatch.teamAName;
                  newTemplate.teamBName = newMatch.teamBName;
                  createTemplate()
                "
                [disabled]="!newTemplate.name || !newMatch.location"
              >
                Save Template
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Messages -->
      @if (matchErrorMessage) {
      <div class="error-message">
        {{ matchErrorMessage }}
      </div>
      } @if (matchSuccessMessage) {
      <div class="success-message">
        {{ matchSuccessMessage }}
      </div>
      }

      <div class="modal-actions">
        <button
          class="primary-cta"
          (click)="createMatch()"
          [disabled]="matchLoading"
        >
          @if (matchLoading) {
          <span>Creating...</span>
          } @else {
          <span>Create Match</span>
          }
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Edit Template Modal -->
  @if (showEditTemplateModal) {
  <div class="modal-backdrop" (click)="closeEditTemplateModal()">
    <div class="modal-content glass medium" (click)="$event.stopPropagation()">
      <button
        class="close-modal-btn"
        (click)="closeEditTemplateModal()"
        title="Close"
      >
        &times;
      </button>
      <h3>Edit Template</h3>

      <!-- Name -->
      <div class="form-group">
        <label for="templateName">Template Name *</label>
        <input
          id="templateName"
          type="text"
          placeholder="Enter template name"
          [(ngModel)]="editingTemplate.name"
          required
          class="modern-input"
        />
      </div>

      <!-- Location -->
      <div class="form-group">
        <label for="templateLocation">Location *</label>
        <input
          id="templateLocation"
          type="text"
          placeholder="e.g., Central Stadium, Synthetic Field"
          [(ngModel)]="editingTemplate.location"
          required
          class="modern-input"
        />
      </div>

      <!-- Cost -->
      <div class="form-group">
        <label for="templateCost">Total Match Cost</label>
        <input
          id="templateCost"
          type="number"
          placeholder="e.g., 300"
          [(ngModel)]="editingTemplate.cost"
          min="0"
          step="0.01"
          class="modern-input"
        />
        <small class="hint-text">Leave empty for free matches</small>
      </div>

      <!-- Team Names -->
      <div class="template-team-fields">
        <h4>Team Names</h4>
        <div class="team-fields-grid">
          <div class="form-group">
            <label for="templateTeamA">Team A Name</label>
            <input
              id="templateTeamA"
              type="text"
              placeholder="e.g., Red Team"
              [(ngModel)]="editingTemplate.teamAName"
              class="modern-input"
            />
          </div>

          <div class="form-group">
            <label for="templateTeamB">Team B Name</label>
            <input
              id="templateTeamB"
              type="text"
              placeholder="e.g., Blue Team"
              [(ngModel)]="editingTemplate.teamBName"
              class="modern-input"
            />
          </div>
        </div>
        <small class="hint-text"
          >These names will be suggested when creating a match</small
        >
      </div>

      <div class="modal-actions">
        <button
          class="primary-cta template-update-btn"
          (click)="updateTemplate()"
        >
          Save Changes
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Edit Match Modal -->
  @if (showEditMatchModal) {
  <div class="modal-backdrop" (click)="showEditMatchModal = false">
    <div class="modal-content glass" (click)="$event.stopPropagation()">
      <button
        class="close-modal-btn"
        (click)="showEditMatchModal = false"
        title="Close"
      >
        &times;
      </button>
      <h3>Edit Match</h3>

      <!-- Date & Time -->
      <div class="form-group">
        <label>Match Date & Time *</label>
        <input
          type="datetime-local"
          [(ngModel)]="editMatch.matchDate"
          [min]="getMinDateTime()"
          required
        />
      </div>

      <!-- Location -->
      <div class="form-group">
        <label>Location *</label>
        <input
          type="text"
          placeholder="e.g., Central Stadium, Synthetic Field..."
          [(ngModel)]="editMatch.location"
          required
        />
      </div>

      <!-- Cost -->
      <div class="form-group">
        <label>Total Match Cost (Lei)</label>
        <input
          type="number"
          placeholder="e.g., 300"
          [(ngModel)]="editMatch.cost"
          min="0"
          step="0.01"
        />
      </div>

      <!-- Team Names -->
      <div class="team-names-section">
        <div class="grid two">
          <div class="form-group">
            <label>Team A Name</label>
            <input
              type="text"
              placeholder="Team A"
              [(ngModel)]="editMatch.teamAName"
              maxlength="50"
            />
          </div>
          <div class="form-group">
            <label>Team B Name</label>
            <input
              type="text"
              placeholder="Team B"
              [(ngModel)]="editMatch.teamBName"
              maxlength="50"
            />
          </div>
        </div>
      </div>

      <!-- Messages -->
      @if (editMatchErrorMessage) {
      <div class="error-message">
        {{ editMatchErrorMessage }}
      </div>
      }

      <button
        class="primary-cta"
        (click)="updateMatch()"
        [disabled]="editMatchLoading"
      >
        @if (editMatchLoading) {
        <span>Updating...</span>
        } @else {
        <span>Update Match</span>
        }
      </button>
    </div>
  </div>
  }

  <!-- Add Players Modal -->
  @if (showAddPlayersModal) {
  <div class="modal-backdrop" (click)="closeAddPlayersModal()">
    <div
      class="modal-content glass add-players-modal"
      (click)="$event.stopPropagation()"
    >
      <button
        class="close-modal-btn"
        (click)="closeAddPlayersModal()"
        title="Close"
      >
        &times;
      </button>

      <h3>
        {{ isViewOnlyMode ? "View Match Players" : "Add Players to Match" }}
      </h3>
      <div class="match-info">
        <p>
          <strong
            >{{ selectedMatch?.teamAName || "TeamA" }} vs
            {{ selectedMatch?.teamBName || "TeamB" }}</strong
          >
        </p>
        <p>
          {{ selectedMatch?.matchDate | date : "short" }} -
          {{ selectedMatch?.location }}
        </p>
      </div>

      <div class="team-builder-layout">
        <!-- Available Players (Left) -->
        <div class="available-players-panel">
          <div class="panel-header">
            <h4><i class="icon-users"></i>Available Players</h4>
            <span class="players-count"
              >{{ availablePlayers.length }} players</span
            >
          </div>

          <div class="players-list-simple">
            <div
              *ngFor="let player of availablePlayers; let i = index"
              class="player-row-simple"
              [class.already-added]="isPlayerInAnyTeam(player)"
            >
              <div class="player-name-rating">
                <span class="name">{{ player.username }}</span>
                <span class="rating"
                  >({{ player.rating | number : "1.0-1" }})</span
                >
              </div>

              <div class="action-buttons">
                <button
                  class="add-btn team1-btn"
                  (click)="addPlayerToTeam(player, 'teamA')"
                  [disabled]="
                    isPlayerInAnyTeam(player) || teamAPlayers.length >= 6
                  "
                  title="Add to {{ selectedMatch?.teamAName || 'Team 1' }}"
                >
                  T1
                </button>
                <button
                  class="add-btn team2-btn"
                  (click)="addPlayerToTeam(player, 'teamB')"
                  [disabled]="
                    isPlayerInAnyTeam(player) || teamBPlayers.length >= 6
                  "
                  title="Add to {{ selectedMatch?.teamBName || 'Team 2' }}"
                >
                  T2
                </button>
              </div>
            </div>

            <div *ngIf="players.length === 0" class="empty-state">
              <i class="icon-users-empty"></i>
              <p>No players available</p>
            </div>
          </div>
        </div>

        <!-- Teams Display (Right) -->
        <div class="teams-panel">
          <div class="panel-header">
            <button class="action-btn" title="Shuffle" (click)="shuffleTeams()">
              Shuffle Teams
            </button>
            <select
              class="balance-mode-select"
              (ngModelChange)="balanceTeams()"
            >
              <option value="rating">Balance by Rating</option>
              <option value="random">Random Shuffle</option>
            </select>
          </div>
          <div class="teams-container">
            <!-- Team 1 -->
            <div class="team-table">
              <div class="team-header">
                <div class="team-title">
                  <h4>{{ selectedMatch?.teamAName || "Team A" }}</h4>
                  <div
                    class="team-avg-rating"
                    [ngClass]="
                      getTeamRatingClass(getTeamAverageRating(teamAPlayers))
                    "
                  >
                    Average Rating:
                    {{ getTeamAverageRatingDisplay(teamAPlayers) }}
                  </div>
                </div>
              </div>

              <div class="team-players-simple">
                <div
                  *ngFor="let player of teamAPlayers; let i = index"
                  class="simple-player-row"
                >
                  <span class="player-name"
                    >{{ player.username }} ({{
                      player.rating | number : "1.0-1"
                    }})</span
                  >
                  <div class="player-actions" *ngIf="!isViewOnlyMode">
                    <button
                      class="move-btn"
                      (click)="movePlayerToOtherTeam(player, 'teamA')"
                      title="Move to Team 2"
                      [disabled]="addingPlayers || teamBPlayers.length >= 6"
                    >
                      →
                    </button>
                    <button
                      class="remove-btn-simple"
                      (click)="removePlayerFromTeam(player, 'teamA')"
                      title="Remove from team"
                      [disabled]="addingPlayers"
                    >
                      ×
                    </button>
                  </div>
                </div>

                <!-- Empty slots -->
                <div
                  *ngFor="
                    let slot of getEmptySlots(teamAPlayers.length);
                    let i = index
                  "
                  class="empty-slot-simple"
                >
                  <span class="empty-text">Empty slot</span>
                </div>
              </div>
            </div>

            <!-- Team 2 -->
            <div class="team-table">
              <div class="team-header">
                <div class="team-title">
                  <h4>{{ selectedMatch?.teamBName || "Team B" }}</h4>
                  <div
                    class="team-avg-rating"
                    [ngClass]="
                      getTeamRatingClass(getTeamAverageRating(teamBPlayers))
                    "
                  >
                    Average Rating:
                    {{ getTeamAverageRatingDisplay(teamBPlayers) }}
                  </div>
                </div>
              </div>

              <div class="team-players-simple">
                <div
                  *ngFor="let player of teamBPlayers; let i = index"
                  class="simple-player-row"
                >
                  <span class="player-name"
                    >{{ player.username }} ({{
                      player.rating | number : "1.0-1"
                    }})</span
                  >
                  <div class="player-actions" *ngIf="!isViewOnlyMode">
                    <button
                      class="move-btn"
                      (click)="movePlayerToOtherTeam(player, 'teamB')"
                      title="Move to Team 1"
                      [disabled]="addingPlayers || teamAPlayers.length >= 6"
                    >
                      ←
                    </button>
                    <button
                      class="remove-btn-simple"
                      (click)="removePlayerFromTeam(player, 'teamB')"
                      title="Remove from team"
                      [disabled]="addingPlayers"
                    >
                      ×
                    </button>
                  </div>
                </div>

                <!-- Empty slots -->
                <div
                  *ngFor="
                    let slot of getEmptySlots(teamBPlayers.length);
                    let i = index
                  "
                  class="empty-slot-simple"
                >
                  <span class="empty-text">Empty slot</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Messages -->
      <div *ngIf="addPlayersErrorMessage" class="error-message">
        {{ addPlayersErrorMessage }}
      </div>

      <div *ngIf="addPlayersSuccessMessage" class="success-message">
        {{ addPlayersSuccessMessage }}
      </div>

      <!-- Actions -->
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="closeAddPlayersModal()">
          Close
        </button>
      </div>
    </div>
  </div>
  }
</div>
